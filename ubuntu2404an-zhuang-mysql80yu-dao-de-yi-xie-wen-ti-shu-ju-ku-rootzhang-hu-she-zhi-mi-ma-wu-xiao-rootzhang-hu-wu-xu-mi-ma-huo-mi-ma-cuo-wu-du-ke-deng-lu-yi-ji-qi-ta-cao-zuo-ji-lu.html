<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>解决Ubuntu安装MySQL8.0后 数据库root设置密码无效, root无需密码或密码错误都可登录 - Merack&#x27;s Home</title><meta name="description" content="Ubuntu24.04使用apt-get安装MySQL8.0后发现数据库的root账户竟然不用密码也能登录尝试随便输入一个密码也能登录, 使用 ALTER USER 'root'@'localhost' IDENTIFIED BY 'new passwd'; 语句修改密码后问题依然存在,&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://blog.merack.top/ubuntu2404an-zhuang-mysql80yu-dao-de-yi-xie-wen-ti-shu-ju-ku-rootzhang-hu-she-zhi-mi-ma-wu-xiao-rootzhang-hu-wu-xu-mi-ma-huo-mi-ma-cuo-wu-du-ke-deng-lu-yi-ji-qi-ta-cao-zuo-ji-lu.html"><link rel="alternate" type="application/atom+xml" href="https://blog.merack.top/feed.xml"><link rel="alternate" type="application/json" href="https://blog.merack.top/feed.json"><link rel="shortcut icon" href="https://blog.merack.top/media/website/favicon-16x16.png" type="image/png"><link rel="stylesheet" href="https://blog.merack.top/assets/css/style.css"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.merack.top/ubuntu2404an-zhuang-mysql80yu-dao-de-yi-xie-wen-ti-shu-ju-ku-rootzhang-hu-she-zhi-mi-ma-wu-xiao-rootzhang-hu-wu-xu-mi-ma-huo-mi-ma-cuo-wu-du-ke-deng-lu-yi-ji-qi-ta-cao-zuo-ji-lu.html"},"headline":"解决Ubuntu安装MySQL8.0后 数据库root设置密码无效, root无需密码或密码错误都可登录","datePublished":"2024-06-16T23:06+08:00","dateModified":"2024-11-15T11:42+08:00","description":"Ubuntu24.04使用apt-get安装MySQL8.0后发现数据库的root账户竟然不用密码也能登录尝试随便输入一个密码也能登录, 使用 ALTER USER 'root'@'localhost' IDENTIFIED BY 'new passwd'; 语句修改密码后问题依然存在,&hellip;","author":{"@type":"Person","name":"Merack","url":"https://blog.merack.top/authors/merack/"},"publisher":{"@type":"Organization","name":"Merack"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://blog.merack.top/">Merack&#x27;s Home</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://blog.merack.top/about.html" target="_self">About</a></li></ul></nav></header><main class="post"><article class="content"><div class="hero hero--noimage"><header class="hero__content"><div class="wrapper"><h1>解决Ubuntu安装MySQL8.0后 数据库root设置密码无效, root无需密码或密码错误都可登录</h1><div class="feed__meta content__meta"><img src="https://blog.merack.top/media/website/qbanjinmuyan_Kan-Tu-Wang.web-2.png" loading="eager" height="500" width="458" class="feed__author-thumb" alt="Merack"> <a href="https://blog.merack.top/authors/merack/" class="feed__author">Merack</a> <time datetime="2024-06-16T23:06" class="feed__date">June 16, 2024</time></div></div></header></div><div class="entry-wrapper content__entry"><p>Ubuntu24.04使用apt-get安装MySQL8.0后发现数据库的root账户竟然不用密码也能登录</p><figure class="alignnone size-full wp-image-41"><img loading="lazy" src="https://cdn.merack.top/wp-content/uploads/2024/06/screenshot_2024_0616_21-04-26.png" alt="" width="708" height="279" data-is-external-image="true"></figure>尝试随便输入一个密码也能登录, 使用 ALTER USER 'root'@'localhost' IDENTIFIED BY 'new passwd'; 语句修改密码后问题依然存在, 以前使用MySQL5.7并未发现相关的问题.<p></p><h3>原因</h3><p>通过查找资料发现是MySQL8.0开始更改了root账户的默认密码验证插件为<a href="https://dev.mysql.com/doc/mysql-secure-deployment-guide/8.0/en/secure-deployment-configure-authentication.html">auth_socket</a>导致的, 可以通过一下命令查看数据库中的用户使用的身份验证插件:</p><pre>SELECT user, host, plugin FROM mysql.user;</pre><figure class="alignnone size-full wp-image-43"><img loading="lazy" src="https://cdn.merack.top/wp-content/uploads/2024/06/screenshot_2024_0616_21-32-04.png" alt="" width="535" height="254" data-is-external-image="true"></figure><br>可以看到root使用的身份验证插件是auth_socket, 其他用户默认是caching_sha2_password. auth_socket这个插件是通过Unix socket文件来进行身份验证, 简单来说就是你在Linux系统的登录名为root, 那么当登录数据库的root账号时数据库会与系统进行socket通信, 发现要登录的用户名是相同的, 那么就会允许这次登录, 详细信息可以看MySQL的官方文档: <a href="https://dev.mysql.com/doc/mysql-secure-deployment-guide/8.0/en/secure-deployment-configure-authentication.html">auth_socket</a> 以及这篇文章: <a href="https://segmentfault.com/a/1190000039860881">https://segmentfault.com/a/1190000039860881</a><br>MySQL8.0以上将其作为root的默认身份插件有一定的道理, 首先, Unix socket通信只能是在本机的程序之间进行, 不会通过TCP/IP网络栈, 不用当心来自外部的爆破;  二是Linux本身的身份验证已经很完善, 用户如果能以root登录系统, 那么无论使用何种插件都能被轻易地修改密码.<p></p><h3>更改身份验证插件</h3><p>如果想用账户密码方式的身份验证, 可以通过以下语句更改, WITH 后面是身份验证插件名称, BY 后面是登录密码:</p><pre>ALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY 'new password';</pre><figure class="alignnone size-full wp-image-43"><img loading="lazy" src="https://cdn.merack.top/wp-content/uploads/2024/06/screenshot_2024_0616_21-53-04.png" alt="" width="797" height="323" data-is-external-image="true"></figure><p>可以看到root的身份验证插件已经改为caching_sha2_password<br>改完以后需要提供正确的密码才能登录</p><figure class="alignnone size-full wp-image-44"><img loading="lazy" src="https://cdn.merack.top/wp-content/uploads/2024/06/screenshot_2024_0616_21-56-15.png" alt="" width="768" height="98" data-is-external-image="true"></figure>需要注意的是, 有一些文章WITH 后面跟的是mysql_native_password, 但是根据官方文档: <a href="https://dev.mysql.com/doc/refman/8.0/en/native-pluggable-authentication.html">https://dev.mysql.com/doc/refman/8.0/en/native-pluggable-authentication.html</a> 中的描述, mysql_native_password插件会在MySQL 8.0.34中弃用并且在后续版本中删除, 官方更推荐caching_sha2_password, 具有更好的安全性.<p></p><h3>mysql_secure_installation</h3><p>实际上, 根据MySQL官方文档"安装后的设置与测试"(<a href="https://dev.mysql.com/doc/refman/8.0/en/postinstallation.html">Postinstallation Setup and Testing</a> )一节中的<a href="https://dev.mysql.com/doc/refman/8.0/en/default-privileges.html">Securing the Initial MySQL Account</a> 小节里提到了mysql_secure_installation这个程序, 他随MySQL一同安装, 用于对MySQL安装后, 上线生产环境前的安全初始化, 其中主要包括以下功能:<br>1. 为root账户设置密码;<br>2. 禁止root账户远程访问;<br>3. 删除匿名账户;<br>4. 删除test数据库;</p><p>如果你安装完MySQL后运行这个程序, 就能发现问题所在, 程序提示root用户正在使用auth_socket, 因此跳过密码设置, 所以平时还是要多看看文档^_^</p><figure class="alignnone size-full wp-image-45"><img loading="lazy" src="https://cdn.merack.top/wp-content/uploads/2024/06/screenshot_2024_0616_22-45-39.png" alt="" width="1023" height="320" data-is-external-image="true"></figure><h3>内存优化</h3><p>如果你的主机内存很小, 那么建议修改MySQL配置文件, 在 [mysqld] 下添加:<br><code>performance_schema = off</code><br>亲测可以减少100多M的内存, <code>performance_schema</code> 是用来记录MySQL查询性能相关的记录, 用于给数据库管理员做性能分析的, 如果你没有这方面的需求, 那么可以关闭它.</p></div><footer class="content__footer"><div class="entry-wrapper"><div class="content__actions"><ul class="content__tag"><li><a href="https://blog.merack.top/tags/linux/">Linux</a></li></ul></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-prev"><a href="https://blog.merack.top/yong-you-pai-yun-zuo-wei-cdnjia-su-github-pagesjian-yao-pei-zhi-ji-lu-2.html" class="content__nav-link" rel="prev"><div><span>Previous</span> 使用又拍云加速GitHub Pages简要配置</div></a></div><div class="content__nav-next"><a href="https://blog.merack.top/shi-yong-you-pai-yun-jia-su-wordpresshou-tai-yang-shi-shi-xiao-hou-tai-cai-dan-gong-neng-dian-ji-wu-fan-ying-jie-jue-fang-fa-ji-jian-yao-pei-zhi.html" class="content__nav-link" rel="next"><div><span>Next</span> 使用又拍云加速WordPress简要配置, 解决后台样式失效, 后台功能点击无反应问题</div></a></div></div></div></nav></footer></article></main><footer class="footer"><div class="wrapper"><div class="footer__copyright"><p>Powered by Publii</p><div style="flex; align-items: center; justify-content: center;"><a href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img style="margin-right: 1px; vertical-align: middle;" src="https://cdn.merack.top/wp-content/uploads/2024/12/8a9de8d6-7a3c-e553-b074-cf653f15d712.png" alt="upyun"> </a>提供CDN服务</div></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://blog.merack.top/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://blog.merack.top/assets/js/scripts.min.js"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'overlay',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>